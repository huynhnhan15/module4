<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Trang chá»§ Blog AJAX</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="container mt-4">

<h2>ğŸ“ Danh má»¥c</h2>
<nav id="category-menu" class="mb-3">
  <button class="btn btn-outline-secondary btn-sm" onclick="loadPosts()">Táº¥t cáº£</button>
  <button class="btn btn-outline-primary btn-sm mx-1"
          th:each="c : ${categories}"
          th:attr="onclick=|loadPostsByCategory(${c.id})|"
          th:text="${c.name}"></button>
</nav>

<h2>ğŸ“ BÃ i viáº¿t</h2>
<div id="post-list">
  <!-- AJAX sáº½ Ä‘á»• bÃ i viáº¿t vÃ o Ä‘Ã¢y -->
</div>

<script>
  function renderPosts(posts) {
    let html = "";
    posts.forEach(p => {
      html += `
        <div class="border-bottom mb-3 pb-2">
          <h4>${p.title}</h4>
          <p><small>Danh má»¥c: ${p.category?.name || 'KhÃ´ng cÃ³'}</small></p>
          <p>${p.content.substring(0, 100)}...</p>
        </div>
      `;
    });
    $("#post-list").html(html);
  }

  function loadPosts() {
    fetch("/api/posts")
            .then(res => res.json())
            .then(data => renderPosts(data.content));
  }

  function loadPostsByCategory(id) {
    fetch("/api/posts/category/" + id)
            .then(res => res.json())
            .then(data => renderPosts(data));
  }

  // Load máº·c Ä‘á»‹nh
  $(document).ready(loadPosts);
</script>

</body>
</html>
